<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>Rezerwacja - Alibaba & Rozbójnicy</title>
    <link rel="shortcut icon" href="picture/logo2.jpeg" type="image/x-icon">
    <style>
        .form {
            text-align: center;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            padding: 20px 20px;
            margin: 100px auto;
            max-width: 500px;
        }
        .form-control {
            margin-bottom: 20px;
        }
        .form-control label {
            display: block;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .form-control input[type="text"],
        .form-control input[type="email"],
        .form-control input[type="tel"],
        .form-control textarea {
            text-align: center;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 3px;
            background-color: #f9f9f9;
            font-size: 16px;
            resize: vertical;
        }
        .form-control textarea {
            height: 120px;
        }
        .form-control button[type="submit"] {
            background-color: #333;
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 3px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .form-control button[type="submit"]:hover {
            background-color: #555;
        }
        .form-control button[type="reset"] {
            background-color: #333;
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 3px;
            padding: 10px 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .form-control button[type="reset"]:hover {
            background-color: #555;
        }
        .error-message {
            color: red;
            font-size: 14px;
            display: none;
        }
    </style>
</head>

<body>
    <nav>
        <input type="checkbox" id="check">
        <label for="check" class="checkbtn">
            <i class="bi bi-list"></i>
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
              </svg>
        </label>
        <label><a href="index.html"><img src="picture/logo.jpeg" class="logo"></a></label>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="alko.html">Alkohole</a></li>
            <li><a href="promocje.html">Promocje I Wydarzenia</a></li>
            <li><a href="rezerwacja.html">Rezerwacja</a></li>
            <li><a href="o_nas.html">O nas</a></li>
            <li><a href="kontakt.html">Kontakt</a></li>
        </ul>
    </nav>
    
    <div class="form">
        <h1>Zarezerwuj stolik!</h1>
        <form id="contact_form">
            <div id="send_form_status"></div>
            <div class="form-control">
                <label for="name">Imię:</label>
                <input type="text" id="name" name="name" placeholder="Jan" required>
                <div class="error-message" id="name-error">Imię jest wymagane</div>
            </div>
            <div class="form-control">
                <label for="lastname">Nazwisko:</label>
                <input type="text" id="lastname" name="lastname" placeholder="Kowalski" required>
                <div class="error-message" id="lastname-error">Nazwisko jest wymagane</div>
            </div>
            <div class="form-control">
                <label for="email">Adres e-mail:</label>
                <input type="email" id="email" name="email" placeholder="jan.kowalski@gmail.com" required>
                <div class="error-message" id="email-error">Adres e-mail jest wymagany</div>
            </div>
            <div class="form-control">
                <label for="telefon">Numer telefonu:</label>
                <input type="tel" id="phone" name="tel" placeholder="123-456-789" required>
                <div class="error-message" id="phone-error">Numer telefonu jest wymagany</div>
            </div>
            <div class="form-control">
                <label for="dzien">Dzień:</label>
                <input type="date" id="date" name="date" placeholder="" required>
                <div class="error-message" id="date-error">Dzień jest wymagany</div>
            </div>
            <div class="form-control">
                <label for="godzina">Godzina:</label>
                <input type="time" id="time" name="time" placeholder="8:00" required>
                <div class="error-message" id="time-error">Godzina jest wymagana</div>
            </div>
            <div class="form-control">
                <label for="ilosc">Ilość osób:</label>
                <input type="number" id="number" name="number" placeholder="0" required>
                <div class="error-message" id="number-error">Ilość osób jest wymagana</div>
            </div>
            <div class="form-control">
                <label for="Uwagi">Uwagi:</label>
                <textarea name="message" id="message" rows="3" cols="50" placeholder="uwagi do obsługi (nie wiecej jak 200 znaków)" maxlength="200"></textarea>
            </div>
            <div class="form-control">
                <button id="sendBtn" type="button" onclick="saveFormData()">Zarezerwuj</button>
                <button type="reset">Anuluj</button>
            </div>
        </form>
    </div>
    <footer>
        <p>&copy; 2024 Alibaba & Rozbójnicy: Więcej niż Kebab</p>
        <br>
        <p><a href="polityka.html" style="color: white;">Polityka prywatności</a></p>
        <p><a href="kontakt.html" style="color: white;"> Praca</a></p>
    </footer>
    <script>
        const operatingHours = { start: "08:00", end: "23:00" };
        let reservations = [];

        function clearErrorMessages() {
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
        }

        function validateForm() {
            let valid = true;
            clearErrorMessages();

            if (!document.getElementById('name').value.trim()) {
                document.getElementById('name-error').style.display = 'block';
                valid = false;
            }
            if (!document.getElementById('lastname').value.trim()) {
                document.getElementById('lastname-error').style.display = 'block';
                valid = false;
            }
            if (!document.getElementById('email').value.trim()) {
                document.getElementById('email-error').style.display = 'block';
                valid = false;
            }
            if (!document.getElementById('phone').value.trim()) {
                document.getElementById('phone-error').style.display = 'block';
                valid = false;
            }
            if (!document.getElementById('date').value.trim()) {
                document.getElementById('date-error').style.display = 'block';
                valid = false;
            }
            if (!document.getElementById('time').value.trim()) {
                document.getElementById('time-error').style.display = 'block';
                valid = false;
            } else {
                const time = document.getElementById('time').value;
                if (time < operatingHours.start || time > operatingHours.end) {
                    document.getElementById('time-error').innerText = 'Godzina rezerwacji poza godzinami otwarcia (8:00 - 23:00)';
                    document.getElementById('time-error').style.display = 'block';
                    valid = false;
                }
            }
            if (!document.getElementById('number').value.trim()) {
                document.getElementById('number-error').style.display = 'block';
                valid = false;
            } else if (parseInt(document.getElementById('number').value) > 6) {
                document.getElementById('number-error').innerText = 'Maksymalna liczba osób to 6';
                document.getElementById('number-error').style.display = 'block';
                valid = false;
            }

            return valid;
        }

        async function saveFormData() {
            if (!validateForm()) return;

            let name = document.getElementById('name').value;
            let lastname = document.getElementById('lastname').value;
            let email = document.getElementById('email').value;
            let phone = document.getElementById('phone').value;
            let date = document.getElementById('date').value;
            let time = document.getElementById('time').value;
            let number = document.getElementById('number').value;
            let message = document.getElementById('message').value;
            let dateTime = date + ' ' + time;

            // Sprawdź istniejące rezerwacje
            let bookedSeats = 0;
            reservations.forEach(reservation => {
                if (reservation.date === date && reservation.time === time) {
                    bookedSeats += parseInt(reservation.number);
                }
            });

            if (bookedSeats + parseInt(number) > 6) {
                document.getElementById('number-error').innerText = 'Przepraszamy, ale nie mamy dostępnych tylu miejsc. Maksymalna liczba osób to 6';
                document.getElementById('number-error').style.display = 'block';
                return;
            }

            let reservation = {
                name: name,
                lastname: lastname,
                email: email,
                phone: phone,
                date: date,
                time: time,
                number: number,
                message: message
            };

            try {
                let response = await fetch('/saveReservation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reservation)
                });

                if (response.ok) {
                    reservations.push(reservation);
                    let summaryMessage = "Dziękujemy za dokonanie rezerwacji!\n\n" +
                                         "Imię: " + name + "\n" +
                                         "Nazwisko: " + lastname + "\n" +
                                         "Data: " + date + "\n" +
                                         "Godzina: " + time + "\n" +
                                         "Liczba osób: " + number + "\n" +
                                         "Zapraszamy do naszego lokalu!";
                    alert(summaryMessage);
                    window.location.href = "index.html";
                } else {
                    alert('Błąd podczas zapisywania rezerwacji.');
                }
            } catch (error) {
                console.error('Błąd podczas wysyłania formularza:', error);
                alert('Błąd podczas wysyłania formularza.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            let today = new Date();
            let dd = today.getDate();
            let mm = today.getMonth() + 1;
            let yyyy = today.getFullYear();

            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }

            today = yyyy + '-' + mm + '-' + dd;
            document.getElementById('date').setAttribute('min', today);
            document.getElementById('date').setAttribute('max', '2024-12-31');
            document.getElementById('number').setAttribute('max', '6');
            document.getElementById('number').setAttribute('min', '0');
        });
    </script>
</body>

</html>
